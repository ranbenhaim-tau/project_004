{% extends "base.html" %}
{% block content %}
<h2>Checkout</h2>
<p class="text-muted">Flight: {{ flight.ID }} | {{ flight.Origin_airport }} → {{ flight.Arrival_airport }} | {{ flight.Date_of_departure }} {{ flight.Time_of_departure|hm }}</p>

<table class="table">
  <thead><tr><th>Class</th><th>Seat</th><th>Price</th></tr></thead>
  <tbody>
    {% for t in tickets %}
      <tr>
        <td>{{t.CLASS_Type}}</td>
        <td>{{t.SEAT_Column_number}}{{t.SEAT_Row_num}}</td>
        <td>{{ "$%.2f"|format(t.Price|float) }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
<h4>Total to pay: {{ "$%.2f"|format(total|float) }}</h4>
<p class="mt-1 mb-3">In case of customer cancellation, a cancellation fee of 5% of the order price applies: {{ "$%.2f"|format((total|float)*0.05) }}</p>


<form method="post" class="mt-3">
  {% if buyer_role != 'member' %}
    <h5>Guest details</h5>
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Email</label>
        <input type="email" class="form-control" name="guest_email" required>
        <div class="form-text">If this email belongs to a registered member, please log in to continue.</div>
      </div>
      <div class="col-md-6">
        <label class="form-label">Phone</label>
        <input type="tel" class="form-control" name="guest_phone" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">First name (English)</label>
        <input class="form-control" name="guest_first" required
               pattern="[A-Za-z][A-Za-z \-']{0,48}[A-Za-z]?"
               title="Please use English letters only (spaces, hyphens, and apostrophes are allowed).">
      </div>
      <div class="col-md-6">
        <label class="form-label">Last name (English)</label>
        <input class="form-control" name="guest_last" required
               pattern="[A-Za-z][A-Za-z \-']{0,48}[A-Za-z]?"
               title="Please use English letters only (spaces, hyphens, and apostrophes are allowed).">
      </div>
    </div>
  {% else %}
    <h5>Your details</h5>
    <div class="alert alert-info mb-3">
      This order will be registered under: <strong>{{session_user}}</strong><br>
      You can edit your details below — changes will be saved to your account.
    </div>

    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">First name (English)</label>
        <input class="form-control" name="member_first" value="{{ member_profile.first if member_profile else '' }}" required
               pattern="[A-Za-z][A-Za-z \-']{0,48}[A-Za-z]?"
               title="Please use English letters only (spaces, hyphens, and apostrophes are allowed).">
      </div>
      <div class="col-md-4">
        <label class="form-label">Last name (English)</label>
        <input class="form-control" name="member_last" value="{{ member_profile.last if member_profile else '' }}" required
               pattern="[A-Za-z][A-Za-z \-']{0,48}[A-Za-z]?"
               title="Please use English letters only (spaces, hyphens, and apostrophes are allowed).">
      </div>
      <div class="col-md-4">
        <label class="form-label">Phone</label>
        <input type="tel" class="form-control" name="member_phone" value="{{ member_profile.phone if member_profile else '' }}" required>
      </div>
    </div>
  {% endif %}

  <button class="btn btn-success mt-3">Confirm order</button>
</form>
{% endblock %}
